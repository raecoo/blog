---
layout: post
title: 灵活使用Rails环境配置文件
---

刚才和<a href="http://iceskysl.1sters.com/">Iceskysl</a>聊天扯到了使用Sphinx做全文检索的问题,他们的应用里用到了多个DB库,在Rails里通过use_db这个插件来实现分库的读写操作,但在生成Sphinx的配置文件就有些问题了,Ultrasphinx并不识别多数据库配置,而且生成索引配置文件时也是根据当前运行环境来生成的.这就会发生非当前运行环境的那个库无法创建索引配置文件.
<!--more-->
其实这个场景用Rails的环境配置文件处理起来非常简单.通常Rails默认提供development/test/production三种环境,这时我们再自己添加一个,比如叫:second,具体配置可以根据情况而定,然后在database.yml里再添加一个对应此环境的DB配置指向第二个DB库,好了,此时我们有第二个库的配置了,生成索引配置文件时只需要指定一个运行环境(RAILS_ENV=second)即可.

后续的工作就是手工或写脚本将两个索引配置文件合并成一个就完成了多库的配置.

类似这样的场景其实很多见,通常在项目开发过程中.会有一个内部的生产环境用来测试或demo项目的功能,也要用到production的环境配置,但又与真实的外网环境不一样,包括代码部署等一系列问题也可以通过此方法解决.
